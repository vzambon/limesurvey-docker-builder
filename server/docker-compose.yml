services:
  limesurvey:
    image: limesurvey:6.14.3
    volumes:
      - ./plugins:/var/www/html/upload/plugins
      - ./limesurvey-cron:/etc/cron.d/limesurvey-cron
      - ./logs:/var/log/app
      - lime:/var/www/html
      - ../commands/InstallUploadedThemeCommand.php:/var/www/html/application/commands/InstallUploadedThemeCommand.php:ro
    networks:
      - lime_network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      - lime_pgsql
    env_file:
      - ./.env

  web:
    image: docker.io/nginx:alpine
    networks:
      - lime_network
    depends_on:
      - limesurvey
    ports:
      - "8080:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - lime:/var/www/html

  lime_pgsql:
    container_name: pgsql-limesurvey
    image: postgres:14.10
    environment:
        POSTGRES_DB: ${DB_NAME:-limesurvey}
        POSTGRES_USER: ${DB_USER:-admin}
        POSTGRES_PASSWORD: ${DB_PASSWORD:-password}
    volumes:
        - lime_database:/var/lib/postgresql/data
    networks:
        - lime_network
    ports:
        - 6543:5432
    
volumes:
  lime:
    name: lime_data
  lime_database:
    name: lime_database
networks:
  lime_network:
    name: lime_network